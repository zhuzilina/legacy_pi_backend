# 🚀 AI Chat API 快速测试指南

## 📋 测试程序概览

我为您创建了3个测试程序，满足不同的测试需求：

| 程序 | 用途 | 适用场景 |
|------|------|----------|
| `test_ai_chat_simple.py` | 快速基础测试 | 新手入门、快速验证 |
| `test_image_chat.py` | 图片功能专项测试 | 图片对话功能测试 |
| `test_ai_chat_api.py` | 完整API测试套件 | 全面功能测试 |

## 🎯 快速开始

### 1. 确保服务运行
```bash
# 激活虚拟环境
source venv/bin/activate

# 启动Django服务器
python manage.py runserver 0.0.0.0:8000
```

### 2. 基础功能测试（推荐首次使用）
```bash
# 测试基础对话功能
python test_ai_chat_simple.py

# 测试图片对话功能
python test_ai_chat_simple.py your_image.jpg
```

### 3. 图片功能专项测试
```bash
# 测试单张图片
python test_image_chat.py image1.jpg

# 测试多张图片
python test_image_chat.py image1.jpg image2.png image3.gif

# 测试所有jpg图片
python test_image_chat.py *.jpg
```

### 4. 完整功能测试
```bash
# 只测试基础功能
python test_ai_chat_api.py --basic-only

# 完整测试（包含图片）
python test_ai_chat_api.py --images image1.jpg image2.png
```

## 📸 测试图片准备

### 支持的图片格式
- **JPEG** (.jpg, .jpeg) - 推荐
- **PNG** (.png) - 推荐
- **GIF** (.gif)
- **WEBP** (.webp)

### 图片要求
- 文件大小：最大 5MB
- 建议尺寸：800x600 到 1920x1080
- 内容：风景、人物、物体、文字等

### 测试图片建议
准备以下类型的图片进行测试：
1. **风景照片** - 测试场景识别
2. **人物照片** - 测试人物识别
3. **文字图片** - 测试OCR功能
4. **复杂场景** - 测试综合分析能力

## 🧪 测试示例

### 示例1：基础对话测试
```bash
python test_ai_chat_simple.py
```

**预期输出：**
```
🧪 AI Chat API 简单测试
==================================================
🏥 测试服务健康状态...
✅ 服务正常运行!

🤖 测试简单对话...
✅ 对话成功!
AI回复: 你好！我是一个专业的AI知识助手...
使用Token: 598

🎉 测试完成!
```

### 示例2：图片对话测试
```bash
python test_ai_chat_simple.py test_image.jpg
```

**预期输出：**
```
🖼️  测试图片对话: test_image.jpg
📤 上传图片...
✅ 图片上传成功! ID: img_1234567890
💬 开始图片对话...
✅ 图片对话成功!
AI回复: 这张图片显示了一个美丽的风景...
使用Token: 234
```

### 示例3：多图片测试
```bash
python test_image_chat.py image1.jpg image2.png
```

**预期输出：**
```
🖼️  AI Chat 图片对话测试程序
============================================================
📁 找到 2 个图片文件:
  - image1.jpg
  - image2.png

📋 获取可用的图片提示词类型...
✅ 可用的图片提示词类型:
  - default: 请详细描述这张图片的内容...
  - simple: 请用简洁的语言描述这张图片的主要内容...
  - creative: 请发挥想象力，为这张图片创作一个有趣的故事...

📤 上传图片: image1.jpg
✅ 上传成功! ID: img_1234567890
💬 开始图片对话...
✅ 图片对话成功!

🎨 测试不同提示词类型...
📝 测试提示词: simple
✅ 图片对话成功!

💬 开始多图对话 (共2张图片)...
✅ 多图对话成功!
```

## 🔧 常见问题解决

### 问题1：连接失败
```
❌ 连接失败: Connection refused
```
**解决方案：**
- 检查Django服务器是否运行：`python manage.py runserver 0.0.0.0:8000`
- 检查端口是否被占用
- 确认防火墙设置

### 问题2：图片上传失败
```
❌ 图片上传失败: 文件格式不支持
```
**解决方案：**
- 确认图片格式为 JPEG、PNG、GIF 或 WEBP
- 检查文件大小是否超过5MB
- 确认图片文件没有损坏

### 问题3：API返回错误
```
❌ 对话失败: API key not configured
```
**解决方案：**
- 检查环境变量：`echo $ARK_API_KEY`
- 确认API key有效且有额度
- 重启Django服务器

### 问题4：流式对话失败
```
❌ 失败 流式对话: HTTP状态码: 500
```
**解决方案：**
- 这是已知问题，不影响其他功能
- 可以忽略此错误，其他功能正常

## 📊 测试结果解读

### 成功指标
- ✅ 所有基础API测试通过
- ✅ 图片上传成功
- ✅ 图片对话返回合理内容
- ✅ Token使用量正常

### 性能指标
- **响应时间**：< 10秒（正常）
- **Token使用**：100-1000（根据内容复杂度）
- **成功率**：> 90%（优秀）

## 🎯 测试建议

### 新手用户
1. 先运行 `test_ai_chat_simple.py` 确保基础功能
2. 准备1-2张测试图片
3. 使用 `test_image_chat.py` 测试图片功能

### 开发者
1. 使用 `test_ai_chat_api.py --basic-only` 进行快速验证
2. 定期运行完整测试套件
3. 监控API性能和错误率

### 生产环境
1. 定期运行完整测试
2. 监控图片缓存统计
3. 检查API响应时间和成功率

## 📞 技术支持

如果遇到问题：
1. 查看测试程序的详细错误信息
2. 检查Django服务器日志
3. 确认API配置正确
4. 验证网络连接正常

测试程序会提供详细的诊断信息帮助您快速定位问题！
