# 环境变量配置说明

## 🔑 概述

AI解读应用使用环境变量来管理敏感配置信息，特别是大模型API的访问密钥。这样可以提高安全性，避免将敏感信息硬编码在代码中。

## ⚙️ 必需的环境变量

### ARK_API_KEY
**说明**: 方舟大模型API的访问密钥
**类型**: 字符串
**示例**: `db503448-c18e-421a-b9ac-90a4b787e525`

## 🚀 设置方法

### 方法1: 临时设置 (当前会话有效)

#### Linux/Mac
```bash
export ARK_API_KEY="你的实际API key"
```

#### Windows
```cmd
set ARK_API_KEY=你的实际API key
```

### 方法2: 永久设置 (推荐)

#### Linux/Mac
```bash
# 添加到 ~/.bashrc 文件
echo 'export ARK_API_KEY="你的实际API key"' >> ~/.bashrc

# 重新加载配置
source ~/.bashrc
```

#### Windows
```cmd
# 设置系统环境变量
setx ARK_API_KEY "你的实际API key"
```

### 方法3: 项目级配置 (.env文件)

#### 创建.env文件
```bash
# Linux/Mac
echo 'ARK_API_KEY=你的实际API key' > .env

# Windows
echo ARK_API_KEY=你的实际API key > .env
```

#### .env文件内容示例
```bash
# AI解读应用环境变量配置
ARK_API_KEY=你的实际API key

# 可选配置
# ARK_BASE_URL=https://ark.cn-beijing.volces.com/api/v3
# ARK_MODEL=doubao-seed-1-6-250615
```

## 🔍 验证配置

### 检查环境变量是否设置
```bash
# Linux/Mac
echo $ARK_API_KEY

# Windows
echo %ARK_API_KEY%
```

### 使用配置脚本
```bash
# Linux/Mac
./setup_env.sh

# Windows
setup_env.bat
```

## 🛡️ 安全建议

### 1. 不要提交敏感信息
- `.env` 文件已添加到 `.gitignore`
- 不要在代码中硬编码API密钥
- 不要在公开场合分享API密钥

### 2. 定期轮换密钥
- 定期更换API密钥
- 监控API使用情况
- 及时撤销泄露的密钥

### 3. 权限控制
- 使用最小权限原则
- 限制API访问范围
- 监控异常访问

## 🚨 常见问题

### 问题1: 环境变量未设置
**错误信息**: `❌ 错误: 请先设置 ARK_API_KEY 环境变量`

**解决方案**:
1. 使用 `./setup_env.sh` 脚本
2. 手动设置环境变量
3. 创建 `.env` 文件

### 问题2: API调用失败
**可能原因**:
1. API密钥无效或过期
2. 网络连接问题
3. 模型名称错误

**解决方案**:
1. 验证API密钥
2. 检查网络连接
3. 确认模型配置

### 问题3: 权限不足
**可能原因**:
1. API密钥权限不足
2. 账户余额不足
3. 访问频率限制

**解决方案**:
1. 检查API密钥权限
2. 查看账户状态
3. 调整请求频率

## 📋 配置检查清单

- [ ] 设置了 `ARK_API_KEY` 环境变量
- [ ] API密钥有效且未过期
- [ ] 网络可以访问方舟API
- [ ] 账户有足够的访问权限
- [ ] 环境变量在启动时可用

## 🔧 调试技巧

### 1. 启用详细日志
在 `ai_interpreter/config.py` 中添加：
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### 2. 测试API连接
```bash
curl -H "Authorization: Bearer $ARK_API_KEY" \
     "https://ark.cn-beijing.volces.com/api/v3/models"
```

### 3. 检查Django配置
```bash
python manage.py check
```

## 📚 相关文档

- [方舟API文档](https://ark.cn-beijing.volces.com/docs)
- [Django环境变量配置](https://docs.djangoproject.com/en/stable/topics/settings/)
- [环境变量最佳实践](https://12factor.net/config)

---

**版本**: v2.0  
**更新时间**: 2025-09-02  
**状态**: ✅ 环境变量配置优化完成
