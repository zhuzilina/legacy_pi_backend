# Excel题目上传工具使用说明

## 概述

Excel题目上传工具是一个用于批量上传题目到知识问答系统的工具。它能够解析Excel文件中的题目数据，验证数据格式，并批量上传到服务器。

## 功能特性

- ✅ 支持多种题目类型：单选题、多选题、填空题
- ✅ 支持两种分类：党史、理论
- ✅ 支持三种难度：简单、中等、困难
- ✅ 批量上传，支持自定义批次大小
- ✅ 数据验证，确保上传数据的正确性
- ✅ 错误处理，详细显示失败原因
- ✅ Excel模板生成，便于数据准备

## 安装依赖

```bash
# 激活虚拟环境
source venv/bin/activate

# 安装依赖
pip install pandas openpyxl
```

## 使用方法

### 1. 创建Excel模板

```bash
python3 excel_question_uploader.py --create-template questions_template.xlsx
```

这将创建一个包含示例数据的Excel模板文件。

### 2. 准备题目数据

根据模板文件填写题目数据，确保：

- **题目内容**：题目的具体内容
- **题目类型**：单选题/多选题/填空题
- **分类**：党史/理论
- **难度**：简单/中等/困难（可选，默认为中等）
- **选项A/B/C/D**：选择题的选项内容
- **正确答案**：正确答案标识（A、B、C、D或组合）
- **答案解析**：题目的详细解析（可选）
- **标签**：用逗号分隔的标签（可选）

### 3. 验证Excel格式

```bash
python3 excel_question_uploader.py --server http://your-server.com --validate-only questions.xlsx
```

仅验证Excel格式，不上传数据。

### 4. 上传题目

```bash
# 指定服务器地址（必填）
python3 excel_question_uploader.py --server http://your-server.com questions.xlsx

# 指定批量大小
python3 excel_question_uploader.py --server http://your-server.com --batch-size 20 questions.xlsx
```

## Excel格式说明

### 必填列

| 列名 | 说明 | 示例 |
|------|------|------|
| 题目内容 | 题目的具体内容 | 中国共产党成立于哪一年？ |
| 题目类型 | 单选题/多选题/填空题 | 单选题 |
| 分类 | 党史/理论 | 党史 |

### 可选列

| 列名 | 说明 | 示例 |
|------|------|------|
| 难度 | 简单/中等/困难 | 简单 |
| 选项A | 选择题选项A | 1921年 |
| 选项B | 选择题选项B | 1922年 |
| 选项C | 选择题选项C | 1923年 |
| 选项D | 选择题选项D | 1924年 |
| 正确答案 | 正确答案标识 | A |
| 答案解析 | 题目解析 | 中国共产党成立于1921年7月1日。 |
| 标签 | 用逗号分隔的标签 | 党史,建党,基础知识 |

### 题目类型说明

#### 单选题
- 题目类型：`单选题`
- 必须提供：选项A、选项B、选项C、选项D
- 正确答案：单个字母（A、B、C、D）

#### 多选题
- 题目类型：`多选题`
- 必须提供：选项A、选项B、选项C、选项D
- 正确答案：多个字母组合（如：ABCD、AC等）

#### 填空题
- 题目类型：`填空题`
- 必须提供：正确答案
- 不需要选项列

## 命令行参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `--server` | 服务器地址 | 必填 |
| `--api-key` | API密钥 | 无 |
| `--batch-size` | 批量上传大小 | 10 |
| `--validate-only` | 仅验证格式 | False |
| `--create-template` | 创建模板文件 | 无 |

## 示例

### 创建模板
```bash
python3 excel_question_uploader.py --create-template my_template.xlsx
```

### 验证格式
```bash
python3 excel_question_uploader.py --server http://your-server.com --validate-only my_questions.xlsx
```

### 上传题目
```bash
python3 excel_question_uploader.py --server http://your-server.com --batch-size 5 my_questions.xlsx
```

## 错误处理

工具会详细显示以下错误信息：

- 缺少必填字段
- 无效的题目类型
- 无效的分类
- 无效的难度
- 选择题缺少选项
- 填空题缺少正确答案
- 网络连接错误
- 服务器响应错误

## 输出示例

### 成功上传
```
📖 解析Excel文件: questions.xlsx
✅ 解析完成，共找到 10 道题目
📤 开始上传 10 道题目...
📦 上传第 1/1 批 (10 道题目)...
✅ 第 1 批上传完成: 成功 10, 失败 0

📊 上传完成:
   总题目数: 10
   成功: 10
   失败: 0

🎉 所有题目上传成功！
```

### 部分失败
```
📖 解析Excel文件: questions.xlsx
✅ 解析完成，共找到 10 道题目
📤 开始上传 10 道题目...
📦 上传第 1/1 批 (10 道题目)...
✅ 第 1 批上传完成: 成功 8, 失败 2

📊 上传完成:
   总题目数: 10
   成功: 8
   失败: 2

❌ 错误详情:
   - 题目 3: 缺少必填字段: 题目内容
   - 题目 7: 无效的题目类型: 判断题

⚠️  上传完成，但有 2 道题目失败
```

## 注意事项

1. **数据格式**：确保Excel文件格式正确，必填字段不能为空
2. **网络连接**：确保能够访问服务器地址
3. **批量大小**：根据网络状况调整批量大小，避免超时
4. **数据备份**：建议在上传前备份原始数据
5. **权限验证**：如需API密钥，请确保密钥有效

## 技术支持

如遇到问题，请检查：

1. Excel文件格式是否正确
2. 网络连接是否正常
3. 服务器地址是否正确
4. 依赖包是否已安装

## 更新日志

- v1.0.0: 初始版本，支持基本的Excel解析和题目上传功能
